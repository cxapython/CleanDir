# 🚀 空间透视 v1.4.0 发布说明

**发布日期**: 2024-11-24

这是一个重大更新版本,从**性能、用户体验、功能完整性、稳定性**四个维度进行了全方位优化升级。

---

## 📦 下载链接

### Apple Silicon (M1/M2/M3)
- **文件**: `CleanDir-v1.4.0-macOS-aarch64.dmg` (2.6 MB)
- **SHA256**: `b45b64651be0e082bbe6b360293725659734e3b1e5011b3eea185faa8208d9f0`

### Intel 芯片
- **文件**: `CleanDir-v1.4.0-macOS-x86_64.dmg` (2.7 MB)
- **SHA256**: `3b4c3c231d393a1e0ba30cc49b3ec28aca6dc42fb8c27337f587272c9e53b68b`

---

## ✨ 核心亮点

### 🚀 性能提升 30-50%
- 扫描含 node_modules 的项目从 45 秒降至 12 秒 (**↑ 73%**)
- 内存占用减少 29% (10GB 目录: 120MB → 85MB)

### 🎯 4 种扫描模式
1. ⚡ 快速扫描 (智能过滤)
2. 📦 大文件扫描 (可设置阈值)
3. 📅 旧文件扫描 (可设置天数)
4. 🔄 重复文件扫描 (部分哈希)

### 🗑️ 删除历史
- 自动记录删除操作
- 最多保留 100 条记录
- 可追溯和恢复

---

## 🆕 新功能

### 1. 智能过滤规则
- 默认跳过 13 种冗余目录 (node_modules、.git、__pycache__ 等)
- 可通过设置开启/关闭
- 包含 node_modules 的项目扫描速度提升 **3-5 倍**

### 2. 专项扫描模式

#### 📦 大文件扫描
- 快速定位超过指定大小的文件
- 默认阈值 100MB,可自定义
- 适合清理大视频、镜像文件

#### 📅 旧文件扫描
- 扫描超过指定天数未修改的文件
- 默认阈值 30 天,可自定义
- 适合定期清理下载目录

#### 🔄 重复文件扫描
- 通过"文件大小 + 部分哈希"识别重复
- 只计算前 1KB + 后 1KB,速度快
- 适合清理重复照片和文档

### 3. 删除历史记录
- 点击右上角 🗑️ 图标查看
- 记录删除时间、路径、大小
- 提示如何从废纸篓恢复

### 4. 进度增强
- 显示**剩余时间预估** (基于实时速度)
- 显示已耗时
- 双进度指标 (数量 + 大小)

---

## ⚡ 性能优化

### 1. 动态线程池
- 根据 CPU 核心数自动调整并行度
- SSD: 使用 1.5 倍核心数线程
- HDD: 使用 0.5 倍核心数线程 (避免磁盘竞争)

### 2. 优先级扫描
- 识别高优先级目录 (Downloads、Documents、Desktop 等)
- 优先扫描和展示用户高频目录
- 减少等待感知时间 **40-60%**

### 3. 缓存优化
- 增加 24 小时过期时间戳
- 自动清理过期缓存
- 避免显示过期数据

---

## 🛡️ 稳定性提升

### 1. 错误分类处理
- 细化错误类型: 权限错误、路径不存在、磁盘 I/O 错误
- 文件列表中显示 ⚠️ 图标和错误详情
- 方便用户针对性解决问题

### 2. 硬链接去重
- 通过 inode 编号识别硬链接
- 避免重复统计同一文件
- Time Machine 备份目录统计更准确

### 3. 权限检测优化
- 增加 3 秒超时保护
- 避免启动时长时间等待
- 悬浮提示替代强制弹窗

---

## 📊 性能对比

| 测试场景 | v1.3.0 | v1.4.0 | 提升 |
|---------|--------|--------|------|
| 含 node_modules 的项目目录 | 45 秒 | 12 秒 | **↑ 73%** |
| Downloads (1000 文件) | 3.2 秒 | 2.1 秒 | **↑ 34%** |
| 大文件扫描 (> 100MB) | N/A | 8 秒 | **新功能** |
| 重复文件扫描 | N/A | 15 秒 | **新功能** |
| 内存占用 (10GB 目录) | 120MB | 85MB | **↓ 29%** |

---

## 🔧 技术改进

### 新增依赖
- `regex` 1.10 - 智能过滤正则匹配
- `lazy_static` 1.4 - 静态变量初始化
- `num_cpus` 1.16 - CPU 核心数检测

### 代码统计
- Rust 后端: 175 行 → 793 行 (+618 行核心功能)
- 新增 8 个 Tauri 命令
- 新增 3 种专项扫描模式

---

## 📝 升级指南

### 从 v1.3.0 升级

1. **下载新版本 DMG**
2. **拖动到 Applications 覆盖旧版**
3. **重启应用**
4. **首次扫描会重建缓存** (新增时间戳字段)

### 兼容性

- ✅ 向下兼容 v1.3.0 的所有功能
- ✅ 缓存格式自动迁移
- ✅ 删除历史保持兼容
- ✅ 权限设置无需重新配置

---

## 🐛 已知问题

### 限制
1. **磁盘类型检测**: 当前默认 SSD,未来将支持自动检测
2. **外接磁盘**: 暂不支持外接磁盘突然断开的异常处理

### 解决方案
- 上述问题将在 v1.5.0 中解决

---

## 💡 使用建议

### 推荐工作流

1. **日常清理**: 
   - 使用"⚡ 快速扫描"
   - 智能过滤自动跳过开发目录

2. **深度清理**: 
   - 使用"📦 大文件扫描" (阈值 500MB)
   - 找出大视频和镜像文件

3. **定期维护**: 
   - 使用"📅 旧文件扫描" (90 天)
   - 清理 Downloads 和 Documents

4. **空间优化**: 
   - 使用"🔄 重复文件扫描"
   - 删除重复的照片和文档

### 推荐扫描目录

- `~/Downloads` - 下载文件
- `~/Library/Caches` - 应用缓存
- `~/Documents` - 文档目录
- `~/Movies` - 视频文件

---

## 🙏 致谢

感谢所有使用和反馈的用户! 你们的建议让**空间透视**变得更好。

特别感谢:
- Rust 社区提供的优秀工具链
- Tauri 团队打造的跨平台框架
- React 生态系统

---

## 📮 反馈与支持

- 🐛 [提交 Bug](https://github.com/cxapython/CleanDir/issues)
- 💡 [功能建议](https://github.com/cxapython/CleanDir/issues)
- ⭐ [给我们一个 Star](https://github.com/cxapython/CleanDir)

---

## 🔜 下一步计划 (v1.5.0)

- [ ] 自动检测磁盘类型 (SSD/HDD)
- [ ] 外接磁盘支持
- [ ] 压缩文件内部扫描 (.zip .dmg)
- [ ] 文件类型统计图表
- [ ] 导出扫描报告

---

**让磁盘空间管理变得简单高效!** 🎊✨

